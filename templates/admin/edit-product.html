{{ define "title" }}
    <link rel="stylesheet" href="/static/css/edit-product.css">
{{ end }}

{{ define "content" }}
<h1>Edit Product</h1>
<a href="/admin/edit-products">Back</a><br><br>

<form action="/admin/update-product" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="id" value="{{ .Product.ID }}">
    
    <label>Title:</label><br>
    <input type="text" name="title" value="{{ .Product.Title }}" required><br><br>

    <label>Author:</label><br>
    <input type="text" name="author" value="{{ .Product.Author }}" required><br><br>

    <label>Description:</label><br>
    <textarea name="description" required>{{ .Product.Description }}</textarea><br><br>

    <!-- Variant Fields -->
     <h3>Variants</h3>
    <div id="variants-container" class="variants-container">
        {{ range $index, $variant := .Product.Variants }}
            <div class="variant">
                <input type="text" name="variant_id" value="{{ $variant.ID }}" required hidden>
                <label>Price:</label>
                <input type="text" name="price" value="{{ $variant.Price }}" required><br>

                <label>Color:</label>
                <input type="text" name="color" value="{{ $variant.Color }}" required><br>

                <label>Stock:</label>
                <input type="text" name="stock" value="{{ $variant.Stock }}" required><br>

                <br>
                <label>Current Image: {{ $variant.ImagePath }}</label>
                <input type="hidden" name="existing_image_path" value="{{ $variant.ImagePath }}">
                <br>
                <img src="/static/img/{{ .ImagePath }}" value="{{ $variant.ImagePath }}" alt="variant-image" width="100px">
                <br>
                
                <label>Change Image:</label>
                <input type="file" name="variant_image[{{ $index }}]">

                <!-- Inside your main form -->
                <button class="remove-variant-btn" type="submit" name="action" value="remove_variant-{{ $variant.ID }}">Remove Variant</button>
            </div>
        {{ end }}
    </div>
    
    <br>
    <br>
    <br>
    <button type="button" id="add-variant">Add Variant</button><br><br>

    <button type="submit" name="action" value="update">Update Product</button>
</form>

<script>
    let variantCount = document.querySelectorAll('.variant').length; // Start with current count

    document.getElementById('add-variant').addEventListener('click', function () {
        const variantContainer = document.createElement('div');
        variantContainer.classList.add('variant');

        // Hidden variant_id (new variants don't have an ID yet)
        const idInput = document.createElement('input');
        idInput.setAttribute('type', 'hidden');
        idInput.setAttribute('name', 'variant_id');
        idInput.value = 'new';
        variantContainer.appendChild(idInput);

        // Hidden existing_image_path (none for new)
        const existingImageInput = document.createElement('input');
        existingImageInput.setAttribute('type', 'hidden');
        existingImageInput.setAttribute('name', 'existing_image_path');
        existingImageInput.value = '';
        variantContainer.appendChild(existingImageInput);

        // Price
        const priceLabel = document.createElement('label');
        priceLabel.textContent = 'Price:';
        variantContainer.appendChild(priceLabel);

        const priceInput = document.createElement('input');
        priceInput.type = 'text';
        priceInput.name = 'price';
        priceInput.required = true;
        variantContainer.appendChild(priceInput);

        variantContainer.appendChild(document.createElement('br'));

        // Color
        const colorLabel = document.createElement('label');
        colorLabel.textContent = 'Color:';
        variantContainer.appendChild(colorLabel);

        const colorInput = document.createElement('input');
        colorInput.type = 'text';
        colorInput.name = 'color';
        colorInput.required = true;
        variantContainer.appendChild(colorInput);

        variantContainer.appendChild(document.createElement('br'));

        // Stock
        const stockLabel = document.createElement('label');
        stockLabel.textContent = 'Stock:';
        variantContainer.appendChild(stockLabel);

        const stockInput = document.createElement('input');
        stockInput.type = 'text';
        stockInput.name = 'stock';
        stockInput.required = true;
        stockInput.min = '0';
        variantContainer.appendChild(stockInput);

        variantContainer.appendChild(document.createElement('br'));

        // Image
        const imageLabel = document.createElement('label');
        imageLabel.textContent = 'Variant Image:';
        variantContainer.appendChild(imageLabel);

        const imageInput = document.createElement('input');
        imageInput.type = 'file';
        imageInput.name = `variant_image[${variantCount}]`; // ðŸ‘ˆ Dynamic index here
        imageInput.accept = 'image/*';
        variantContainer.appendChild(imageInput);

        variantContainer.appendChild(document.createElement('br'));
        variantContainer.appendChild(document.createElement('br'));

        // Append new variant block
        document.getElementById('variants-container').appendChild(variantContainer);

        variantCount++; // Increment for next added variant
    });
</script>



{{ end }}
